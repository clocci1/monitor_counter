<!doctype html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stock Control - Productivity | Overview</title>

  <style>
    :root{
      --bg:#0b0f14;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.04);
      --stroke:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --shadow:0 18px 55px rgba(0,0,0,.55);
      --radius:16px;

      /* Activity colors */
      --c-pick:  rgba(91,140,255,.68);   /* PI Pick azzurro */
      --c-bulk:  rgba(47,86,255,.68);    /* PI Bulk blu */
      --c-p2p:   rgba(45,212,191,.70);   /* P2P verde */
      --c-clp:   rgba(14,166,94,.72);    /* CLP verde scuro */
      --c-pause: rgba(255,77,109,.78);   /* Pausa rosso */
      --c-mix:   rgba(255,255,255,.14);
    }

    *{box-sizing:border-box}
    body{
      margin:0; min-height:100vh;
      background:
        radial-gradient(1000px 500px at 10% -10%, rgba(124,92,255,.35), transparent 60%),
        radial-gradient(800px 500px at 100% 0%, rgba(45,212,191,.18), transparent 60%),
        var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    /* App layout: main + right sidebar */
    .app{
      display:grid;
      grid-template-columns: 1fr 320px;
      min-height:100vh;
      gap:12px;
      padding:16px;
      max-width: 1500px;
      margin: 0 auto;
    }
    @media(max-width: 1100px){
      .app{grid-template-columns: 1fr; }
      .rightbar{position:relative; top:auto; height:auto;}
    }

    .main{
      min-width:0;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    .rightbar{
      position:sticky;
      top:16px;
      align-self:start;
      height: calc(100vh - 32px);
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:auto;
      padding:12px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding:14px 14px 0 14px;
    }
    h1{margin:0;font-size:22px}
    .subtitle{color:var(--muted);font-size:13px;line-height:1.45;max-width:980px;margin-top:6px}

    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:900;
      font-size:13px;
      transition:transform .08s ease, background .12s ease, border-color .12s ease;
    }
    .btn:hover{background:rgba(255,255,255,.10);border-color:rgba(255,255,255,.16)}
    .btn:active{transform:scale(.98)}
    .btn.primary{border-color:rgba(124,92,255,.55);background:rgba(124,92,255,.18)}
    .btn.danger{border-color:rgba(255,77,109,.45);background:rgba(255,77,109,.12)}
    .btn:disabled{opacity:.55;cursor:not-allowed}

    .panel{
      border:1px solid var(--stroke);
      border-radius:var(--radius);
      background:rgba(255,255,255,.03);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .panelHeader{
      padding:10px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      background: rgba(255,255,255,.02);
    }
    .panelHeader strong{
      font-size:12px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.2px;
    }
    .panelHeaderRight{
      display:flex; align-items:center; gap:8px; min-width:0;
    }

    table{width:100%;border-collapse:collapse;font-size:12.5px}
    th,td{padding:9px 10px;border-bottom:1px solid rgba(255,255,255,.08);text-align:left;color:rgba(255,255,255,.86)}
    th{
      position:sticky; top:0;
      background:rgba(10,14,20,.85);
      backdrop-filter:blur(10px);
      color:rgba(255,255,255,.75);
      font-weight:900;
      letter-spacing:.2px;
    }
    tr:hover td{background:rgba(255,255,255,.03)}
    .link{color:#9cc2ff;text-decoration:none;font-weight:900;cursor:pointer}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;}

    /* Row highlight by activity */
    tr.row-pick  td{ background: color-mix(in srgb, var(--c-pick) 22%, transparent); }
    tr.row-bulk  td{ background: color-mix(in srgb, var(--c-bulk) 22%, transparent); }
    tr.row-p2p   td{ background: color-mix(in srgb, var(--c-p2p) 22%, transparent); }
    tr.row-clp   td{ background: color-mix(in srgb, var(--c-clp) 22%, transparent); }
    tr.row-pause td{ background: color-mix(in srgb, var(--c-pause) 22%, transparent); }

    /* Right sidebar blocks */
    .rbBlock{border:1px solid rgba(255,255,255,.10);border-radius:14px;background:rgba(0,0,0,.18);padding:10px}
    .rbTitle{font-size:12px;color:rgba(255,255,255,.65);font-weight:1000;margin-bottom:8px}
    .row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    select,input{
      background:rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      padding:9px 10px;
      border-radius:12px;
      outline:none;
      width:100%;
    }
    .small{color:var(--muted);font-size:12px;margin-top:6px;line-height:1.35}
    .dot{width:8px;height:8px;border-radius:50%;background:rgba(255,255,255,.25);display:inline-block}
    .dot.ok{background:rgba(45,212,191,.95)}
    .dot.bad{background:rgba(255,77,109,.95)}
    .pill{
      display:flex;gap:8px;align-items:center;
      padding:10px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.18);
      color:rgba(255,255,255,.75);
      font-size:12px;
      justify-content:space-between;
    }

    /* Date strip (PBI style) */
    .strip{
      display:flex; align-items:center; gap:8px; min-width:0;
    }
    .stripBtn{
      appearance:none;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(255,255,255,.06);
      color:rgba(255,255,255,.85);
      border-radius:12px;
      padding:6px 9px;
      cursor:pointer;
      font-weight:1000;
    }
    .stripBtn:disabled{opacity:.4;cursor:not-allowed}
    .stripScroll{
      display:flex; gap:6px;
      overflow:auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      min-width:0;
      padding-bottom:2px;
    }
    .stripScroll::-webkit-scrollbar{display:none}
    .chip{
      flex:0 0 auto;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.16);
      color:rgba(255,255,255,.80);
      border-radius:999px;
      padding:6px 10px;
      cursor:pointer;
      font-weight:900;
      font-size:12px;
      white-space:nowrap;
    }
    .chip.on{
      border-color:rgba(124,92,255,.55);
      background:rgba(124,92,255,.18);
      color:rgba(255,255,255,.92);
    }

    /* Drilldown section hidden by default */
    #drilldownSection{display:none}

    /* Timeline bars (continuous) */
    .timeBars{display:flex;flex-direction:column;gap:10px;padding:12px}
    .barRow{
      display:grid;
      grid-template-columns: 160px 1fr;
      gap:10px;
      align-items:center;
    }
    .barLabel{color:rgba(255,255,255,.70);font-size:12px}
    .timeBar{
      height:18px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      overflow:hidden;
      display:flex;
    }
    .seg{
      height:100%;
      cursor:pointer;
    }
    .seg:hover{filter:brightness(1.08)}
    .seg.none{background:rgba(255,255,255,.06);cursor:default}

    pre{
      margin:0;padding:12px 14px;max-height:200px;overflow:auto;
      font-size:12px;line-height:1.4;color:rgba(255,255,255,.86)
    }

    /* Modal base */
    .modalOverlay{
      position:fixed;inset:0;background:rgba(0,0,0,.55);
      display:none;align-items:center;justify-content:center;padding:18px;z-index:50
    }
    .modal{
      width:min(980px, 100%);
      background:rgba(12,16,24,.96);
      border:1px solid rgba(255,255,255,.12);
      border-radius:18px;box-shadow:var(--shadow);
      overflow:hidden
    }
    .modalTop{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)
    }
    .modalTop strong{font-size:16px}
    .modalBody{padding:16px}
    .formRow{display:grid;grid-template-columns:1.2fr 1fr 1fr auto;gap:10px;align-items:center}
    @media(max-width:980px){.formRow{grid-template-columns:1fr}}
    .modalActions{display:flex;gap:10px;justify-content:flex-end;padding:14px 16px;border-top:1px solid rgba(255,255,255,.08);background:var(--panel2)}
  </style>
</head>

<body>
  <div class="app">

    <!-- MAIN -->
    <div class="main">
      <div class="panel" style="padding-bottom:12px;">
        <header>
          <div>
            <h1>Stock Control - Productivity — Overview</h1>
            <div class="subtitle">
              Riepilogo + KPI con filtro data avanzato. Il Drill-down appare solo quando clicchi un operatore.
            </div>
          </div>
          <a class="btn" href="./index.html">Import</a>
          <a class="btn" href="./resource.html">Resource</a>
        </header>
      </div>

      <!-- RIEPILOGO -->
      <div class="panel">
        <div class="panelHeader">
          <strong>Riepilogo</strong>
          <div class="panelHeaderRight">
            <div class="strip" id="stripSummary">
              <button class="stripBtn" id="sumLeft">‹</button>
              <div class="stripScroll" id="sumScroll"></div>
              <button class="stripBtn" id="sumRight">›</button>
            </div>
          </div>
        </div>
        <div style="max-height: 320px; overflow:auto;">
          <table id="tblSummary">
            <thead>
              <tr>
                <th>Supporto</th>
                <th>Operatore</th>
                <th>Tot Lavoro</th>
                <th>Pick</th>
                <th>Bulk</th>
                <th>P2P</th>
                <th>CLP</th>
                <th>Pausa</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- KPI -->
      <div class="panel">
        <div class="panelHeader">
          <strong>Overview KPI</strong>
          <div class="panelHeaderRight">
            <div class="strip" id="stripKpi">
              <button class="stripBtn" id="kpiLeft">‹</button>
              <div class="stripScroll" id="kpiScroll"></div>
              <button class="stripBtn" id="kpiRight">›</button>
            </div>
          </div>
        </div>
        <div style="max-height: 320px; overflow:auto;">
          <table id="tblKpi">
            <thead>
              <tr>
                <th>Operatore</th>
                <th>Tot</th>
                <th>Pick</th><th>#BIN</th>
                <th>Bulk</th><th>#BIN</th>
                <th>P2P</th><th>#WO</th>
                <th>CLP</th><th>#WO</th>
                <th>Pausa</th>
                <th>Self</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- DRILLDOWN (hidden until operator click) -->
      <div class="panel" id="drilldownSection">
        <div class="panelHeader">
          <strong>Drill-down</strong>
          <div class="panelHeaderRight" style="gap:10px;">
            <div class="mono" id="ddInfo" style="color:rgba(255,255,255,.65);font-size:12px;"></div>
            <select id="shiftSelect" style="width:160px;">
              <option value="AM">AM 05-13</option>
              <option value="C">C 08-16</option>
              <option value="OM">OM 14-22</option>
            </select>
          </div>
        </div>

        <!-- day chips for drilldown -->
        <div style="padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.08); display:flex; gap:10px; align-items:center;">
          <div style="color:rgba(255,255,255,.65);font-weight:900;font-size:12px;">Data</div>
          <div class="strip" style="flex:1; min-width:0;">
            <button class="stripBtn" id="ddLeft">‹</button>
            <div class="stripScroll" id="ddScroll"></div>
            <button class="stripBtn" id="ddRight">›</button>
          </div>
          <button id="btnExportCsv" class="btn">Esporta intervalli (CSV)</button>
        </div>

        <!-- Timeline multi-day -->
        <div>
          <div style="padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.08);color:rgba(255,255,255,.70);font-weight:900;font-size:12px;">
            Timeline (una barra per giorno filtrato — click su PAUSA per attività indiretta)
          </div>
          <div class="timeBars" id="timelineMulti"></div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr; gap:12px; padding:12px;">
          <div class="panel" style="box-shadow:none;">
            <div class="panelHeader"><strong>Sintesi sequenziale</strong></div>
            <div style="max-height: 320px; overflow:auto;">
              <table id="tblBlocks">
                <thead>
                  <tr>
                    <th>Start</th>
                    <th>End</th>
                    <th>Cat</th>
                    <th>Durata</th>
                    <th>#BIN</th>
                    <th>#WO</th>
                    <th>Cambi</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

          <div class="panel" style="box-shadow:none;">
            <div class="panelHeader"><strong>Dettaglio intervalli</strong></div>
            <div style="max-height: 320px; overflow:auto;">
              <table id="tblIntervals">
                <thead>
                  <tr>
                    <th>Start</th>
                    <th>End</th>
                    <th>Cat</th>
                    <th>Durata</th>
                    <th>WO</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- LOG -->
      <div class="panel">
        <div class="panelHeader"><strong>Log</strong></div>
        <pre id="log"></pre>
      </div>
    </div>

    <!-- RIGHT SIDEBAR (was bar) -->
    <aside class="rightbar">
      <div class="pill">
        <div style="display:flex;gap:8px;align-items:center;">
          <span id="authDot" class="dot"></span>
          <span id="authStatus">...</span>
        </div>
        <span class="mono" style="opacity:.85;" id="userId">-</span>
      </div>

      <button id="btnReset" class="btn danger" style="width:100%;">Reset session</button>

      <div class="rbBlock">
        <div class="rbTitle">Filtro temporale</div>

        <div class="row">
          <label class="small" style="width:100%; margin:0;">Tipo</label>
          <select id="rangeType">
            <option value="days">Days</option>
            <option value="weeks">Weeks</option>
            <option value="months">Months</option>
          </select>
        </div>

        <div class="row" style="margin-top:10px;">
          <div style="flex:1;">
            <label class="small" style="margin:0;">Da</label>
            <input id="fromDate" type="date" />
          </div>
          <div style="flex:1;">
            <label class="small" style="margin:0;">A</label>
            <input id="toDate" type="date" />
          </div>
        </div>

        <div style="margin-top:10px;">
          <label class="small" style="margin:0;">Selezione (multi)</label>
          <select id="rangeItems" multiple size="6"></select>
          <div class="small">
            Esempio: scegli Days e seleziona 21–26. Poi puoi rifinire con i bottoni data sui pannelli.
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          <button id="btnApply" class="btn primary" style="width:100%;">Applica</button>
          <button id="btnRefresh" class="btn" style="width:100%;">Aggiorna</button>
        </div>
      </div>

      <!-- Legend at bottom -->
      <div class="rbBlock" style="margin-top:auto;">
        <div class="rbTitle">Legenda</div>
        <div class="row" style="gap:8px;flex-wrap:wrap;">
          <span class="chip" style="cursor:default;border-color:rgba(255,255,255,.10);background:rgba(0,0,0,.14);">
            <span style="display:inline-block;width:10px;height:10px;border-radius:3px;background:var(--c-pick);margin-right:8px;"></span>PI Pick
          </span>
          <span class="chip" style="cursor:default;border-color:rgba(255,255,255,.10);background:rgba(0,0,0,.14);">
            <span style="display:inline-block;width:10px;height:10px;border-radius:3px;background:var(--c-bulk);margin-right:8px;"></span>PI Bulk
          </span>
          <span class="chip" style="cursor:default;border-color:rgba(255,255,255,.10);background:rgba(0,0,0,.14);">
            <span style="display:inline-block;width:10px;height:10px;border-radius:3px;background:var(--c-p2p);margin-right:8px;"></span>P2P
          </span>
          <span class="chip" style="cursor:default;border-color:rgba(255,255,255,.10);background:rgba(0,0,0,.14);">
            <span style="display:inline-block;width:10px;height:10px;border-radius:3px;background:var(--c-clp);margin-right:8px;"></span>CLP
          </span>
          <span class="chip" style="cursor:default;border-color:rgba(255,255,255,.10);background:rgba(0,0,0,.14);">
            <span style="display:inline-block;width:10px;height:10px;border-radius:3px;background:var(--c-pause);margin-right:8px;"></span>Pausa
          </span>
        </div>
      </div>
    </aside>
  </div>

  <!-- SUPPORT MODAL -->
  <div id="supportOverlay" class="modalOverlay">
    <div class="modal">
      <div class="modalTop">
        <div>
          <strong id="supportTitle">Supporto</strong>
          <div id="supportSubtitle" class="small"></div>
        </div>
        <button id="btnCloseSupport" class="btn">Chiudi</button>
      </div>

      <div class="modalBody">
        <div class="formRow">
          <input id="realOperator" placeholder="Supporto reale (nome operatore) es. M.HAYAT" />
          <input id="supportStart" type="datetime-local" />
          <input id="supportEnd" type="datetime-local" />
          <button id="btnAddSupport" class="btn primary">Aggiungi</button>
        </div>

        <div style="margin-top:14px; max-height:260px; overflow:auto;">
          <table id="tblSupportRanges">
            <thead>
              <tr>
                <th>Supporto reale</th>
                <th>Start</th>
                <th>End</th>
                <th>Azioni</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="modalActions">
        <button id="btnRecalc" class="btn primary">OK (Ricalcola)</button>
      </div>
    </div>
  </div>

  <!-- INDIRECT ACTIVITY MODAL -->
  <div id="activityOverlay" class="modalOverlay">
    <div class="modal">
      <div class="modalTop">
        <div>
          <strong id="activityTitle">Attività indiretta</strong>
          <div id="activitySubtitle" class="small"></div>
        </div>
        <button id="btnCloseActivity" class="btn">Chiudi</button>
      </div>

      <div class="modalBody">
        <div class="formRow">
          <input id="activityLabel" placeholder="Es: Briefing, Training, Supporto linee..." />
          <input id="activityStart" type="datetime-local" />
          <input id="activityEnd" type="datetime-local" />
          <button id="btnAddActivity" class="btn primary">Aggiungi</button>
        </div>

        <div style="margin-top:14px; max-height:260px; overflow:auto;">
          <table id="tblActivities">
            <thead>
              <tr>
                <th>Label</th>
                <th>Start</th>
                <th>End</th>
                <th>Azioni</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="modalActions">
        <button id="btnCloseActivity2" class="btn primary">OK</button>
      </div>
    </div>
  </div>

  <script type="module" src="./overview.js"></script>
</body>
</html>
